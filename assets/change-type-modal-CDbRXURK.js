import{j as o,ag as ce,M as de,ah as ue,J as he,N,K as pe,L as ge,aG as ye,aH as me,aI as fe,B as Se,aJ as be,aK as Ce,O as Te,t as xe}from"./chakra-CSR0Uih-.js";import{S as m,d as g,at as y,o as k,m as Ae,l as z,c as je,e as b,q as w,t as M,v as B,C as Le,M as ve,L as Oe,U as Ie,Q as Ee,R as Pe,V as Ne,i as we}from"./index-TYtKMSB_.js";import{u as Me,b as i}from"./react-eFT_xHYJ.js";import{s as f,u as Be}from"./master-manager-BNVmxtPz.js";const R=[m.ShmetroBasic2020,m.LondonTubeBasic,m.ShanghaiSuburbanRailway],Ze=(a,s,n)=>{const r=a.getNodeAttribute(s,"type"),d=structuredClone(a.getNodeAttribute(s,r).names);for(let l=0;l<Math.abs(f[n].defaultAttrs.names.length-d.length);l++)f[n].defaultAttrs.names.length>d.length?d.push("Stn"):d.pop();const t={...f[n].defaultAttrs,names:d};(!Object.values(R).includes(r)||!Object.values(R).includes(n))&&(t.nameOffsetX=a.getNodeAttribute(s,r).nameOffsetX,t.nameOffsetY=a.getNodeAttribute(s,r).nameOffsetY),g.has(n)&&g.has(r)&&(t.color=structuredClone(a.getNodeAttribute(s,r).color)),a.removeNodeAttribute(s,r),a.mergeNodeAttributes(s,{type:n,[n]:t})},He=(a,s,n,r)=>{const d=a.getEdgeAttribute(s,"type"),t=a.getEdgeAttribute(s,"style");if(y[t].metadata.supportLinePathType.includes(n)){const l=structuredClone(k[n].defaultAttrs);let u=-1;if(r){const[h,C]=a.extremities(s),p=l.startFrom;u=Ae(a,n,h,C,p)}a.setEdgeAttribute(s,"parallelIndex",u),a.removeEdgeAttribute(s,d),a.mergeEdgeAttributes(s,{type:n,[n]:l})}},De=(a,s,n,r)=>{const d=a.getEdgeAttribute(s,"type"),t=a.getEdgeAttribute(s,"style");if(console.log(y[n].metadata.supportLinePathType),y[n].metadata.supportLinePathType.includes(d)){const l=a.getEdgeAttribute(s,"zIndex"),u=a.getEdgeAttribute(s,t);a.removeEdgeAttribute(s,t);const h=structuredClone(y[n].defaultAttrs);g.has(t)&&g.has(n)?h.color=u.color:g.has(n)&&r&&(h.color=r),a.mergeEdgeAttributes(s,{style:n,[n]:h}),n===z.River?a.setEdgeAttribute(s,"zIndex",-5):a.setEdgeAttribute(s,"zIndex",l!=null?l:0)}},Ge=a=>{const{isOpen:s,onClose:n,isSelect:r,filter:d}=a,{t}=Me(),l=je(),{selected:u}=b(e=>e.runtime),{preference:{autoParallel:h}}=b(e=>e.app),{activeSubscriptions:C}=b(e=>e.account);i.useCallback(()=>{l(w(p.current.export())),l(M()),l(B())},[l,M,B,w]);const p=i.useRef(window.graph),T={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(k).map(([e,c])=>[e,t(c.metadata.displayName).toString()]))},x={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(y).map(([e,c])=>[e,t(c.metadata.displayName).toString()]))},A={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(f).map(([e,c])=>[e,t(c.metadata.displayName).toString()]))},S={id:"any",theme:[Le.Other,"other","#ffffff",ve.black],value:t("header.settings.procedures.changeType.any")},[W,j]=i.useState(!1),[Z,L]=i.useState(0),[H,v]=i.useState(!1),[D,G]=i.useState("any"),[J,K]=i.useState(m.ShmetroBasic),[X,O]=i.useState(!1),[Y,_]=i.useState("any"),[q,Q]=i.useState(z.SingleColor),[U,I]=i.useState(!1),[V,$]=i.useState("any"),[F,ee]=i.useState(Oe.Diagonal),[te,E]=i.useState(!1),[se,P]=i.useState(S),{theme:ae,requestThemeChange:ne}=Ie(),[oe,ie]=i.useState([]),re=[{id:"changeZIndex",title:t("header.settings.procedures.changeZIndex"),onClose:()=>j(!W),field:[{type:"select",label:t("panel.details.info.zIndex"),value:Z,options:Object.fromEntries(Array.from({length:11},(e,c)=>[c-5,(c-5).toString()])),onChange:e=>L(Number(e))}]},{id:"changeStationType",title:t("header.settings.procedures.changeStationType.title"),onClose:()=>v(!H),field:[{type:"select",label:t("header.settings.procedures.changeStationType.changeFrom"),options:A,value:D,onChange:e=>G(e)},{type:"select",label:t("header.settings.procedures.changeStationType.changeTo"),options:A,value:J,onChange:e=>K(e)}]},{id:"changeLineStyleType",title:t("header.settings.procedures.changeLineStyleType.title"),onClose:()=>O(!X),field:[{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeFrom"),options:x,value:Y,onChange:e=>_(e)},{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeTo"),options:x,value:q,onChange:e=>Q(e)}]},{id:"changeLinePathType",title:t("header.settings.procedures.changeLinePathType.title"),onClose:()=>I(!U),field:[{type:"select",label:t("header.settings.procedures.changeLinePathType.changeFrom"),options:T,value:V,onChange:e=>$(e)},{type:"select",label:t("header.settings.procedures.changeLinePathType.changeTo"),options:T,value:F,onChange:e=>ee(e)}]},{id:"changeColor",title:t("header.settings.procedures.changeColor.title"),onClose:()=>E(!te),field:[{type:"custom",label:t("header.settings.procedures.changeColor.changeFrom"),component:o.jsx(Ee,{data:oe,displayHandler:e=>o.jsx(Pe,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,c)=>c.id.toLowerCase().includes(e.toLowerCase())||Object.values(c.id).some(le=>le.toLowerCase().includes(e.toLowerCase())),value:se.value,onChange:e=>P(e)})},{type:"custom",label:t("header.settings.procedures.changeColor.changeTo"),component:o.jsx(Ne,{theme:ae,onClick:ne})}]}];return i.useEffect(()=>{s&&(j(!1),v(!1),O(!1),I(!1),E(!1),L(0),ie([S,...Be(p.current,r?[...u].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):p.current.nodes(),r?[...u].filter(e=>e.startsWith("line")):p.current.edges()).map(e=>({id:e.toString(),theme:e,value:e[1]==="other"?e[2]:e[1]}))]),P(S))},[s]),o.jsxs(ce,{isOpen:s,onClose:n,size:"md",scrollBehavior:"inside",children:[o.jsx(de,{}),o.jsxs(ue,{children:[o.jsxs(he,{children:[o.jsx(N,{as:"b",fontSize:"xl",children:t(r?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),o.jsx(pe,{})]}),o.jsx(ge,{children:o.jsx(ye,{allowMultiple:!0,children:re.map(e=>o.jsxs(me,{children:[o.jsxs(fe,{onClick:e.onClose,children:[o.jsx(Se,{as:"span",flex:"1",textAlign:"left",children:o.jsx(N,{as:"b",fontSize:"md",children:e.title})}),o.jsx(be,{})]}),o.jsx(Ce,{pb:4,children:o.jsx(we,{fields:e.field,minW:270})})]},e.id))})}),o.jsx(Te,{children:o.jsx(xe,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:t("cancel")})})]})]})};export{Ge as C,De as a,Ze as b,He as c};
