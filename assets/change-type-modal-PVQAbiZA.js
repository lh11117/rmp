import{j as l,ag as ge,M as pe,ah as fe,J as ye,N as q,K as me,L as be,aG as Se,aH as Te,aI as xe,B as Ae,aJ as Ce,aK as je,O as Ee,t as Q,aw as ve}from"./chakra-CSR0Uih-.js";import{d as y,S as T,at as b,o as ee,m as Ie,l as te,c as Oe,e as N,q as U,t as V,v as $,C as Le,M as Ne,L as Pe,U as Be,Q as we,R as Me,V as Re,i as ke}from"./index-9WjS-CZd.js";import{u as ze,b as r}from"./react-eFT_xHYJ.js";import{s as x,u as We}from"./master-manager-B0qDlpvv.js";const F=[T.ShmetroBasic2020,T.LondonTubeBasic,T.ShanghaiSuburbanRailway],Ze=(n,s,o)=>{const i=n.getNodeAttribute(s,"type"),a=structuredClone(n.getNodeAttribute(s,i).names);for(let c=0;c<Math.abs(x[o].defaultAttrs.names.length-a.length);c++)x[o].defaultAttrs.names.length>a.length?a.push("Stn"):a.pop();const e={...x[o].defaultAttrs,names:a};(!Object.values(F).includes(i)||!Object.values(F).includes(o))&&(e.nameOffsetX=n.getNodeAttribute(s,i).nameOffsetX,e.nameOffsetY=n.getNodeAttribute(s,i).nameOffsetY),y.has(o)&&y.has(i)&&(e.color=structuredClone(n.getNodeAttribute(s,i).color)),n.removeNodeAttribute(s,i),n.mergeNodeAttributes(s,{type:o,[o]:e})},He=(n,s,o,i)=>i.filter(a=>s==="any"||n.getNodeAttribute(a,"type")===s).forEach(a=>{Ze(n,a,o)}),_e=(n,s,o,i)=>{const a=n.getEdgeAttribute(s,"type"),e=n.getEdgeAttribute(s,"style");if(b[e].metadata.supportLinePathType.includes(o)){const c=structuredClone(ee[o].defaultAttrs);let d=-1;if(i){const[g,P]=n.extremities(s),A=c.startFrom;d=Ie(n,o,g,P,A)}n.setEdgeAttribute(s,"parallelIndex",d),n.removeEdgeAttribute(s,a),n.mergeEdgeAttributes(s,{type:o,[o]:c})}},De=(n,s,o,i,a)=>i.filter(e=>s==="any"||n.getEdgeAttribute(e,"type")===s).forEach(e=>{_e(n,e,o,a)}),Ge=(n,s,o,i)=>{const a=n.getEdgeAttribute(s,"type"),e=n.getEdgeAttribute(s,"style");if(console.log(b[o].metadata.supportLinePathType),b[o].metadata.supportLinePathType.includes(a)){const c=n.getEdgeAttribute(s,"zIndex"),d=n.getEdgeAttribute(s,e);n.removeEdgeAttribute(s,e);const g=structuredClone(b[o].defaultAttrs);y.has(e)&&y.has(o)?g.color=d.color:y.has(o)&&i&&(g.color=i),n.mergeEdgeAttributes(s,{style:o,[o]:g}),o===te.River?n.setEdgeAttribute(s,"zIndex",-5):n.setEdgeAttribute(s,"zIndex",c!=null?c:0)}},Je=(n,s,o,i,a)=>a.filter(e=>s==="any"||n.getEdgeAttribute(e,"style")===s).forEach(e=>{Ge(n,e,o,i)}),Ke=(n,s,o,i)=>i.filter(a=>y.has(n.getEdgeAttribute(a,"style"))).forEach(a=>{const e=n.getEdgeAttributes(a),c=e[e.style].color;(s==="any"||c[0]==s[0]&&c[1]==s[1]&&c[2]==s[2]&&c[3]==s[3])&&n.mergeEdgeAttributes(a,{[e.style]:{color:o}})}),Xe=(n,s,o,i,a)=>{[...i,...a].forEach(e=>{const c=n.getNodeAttributes(e).type,d=n.getNodeAttribute(e,c);if(d.color!==void 0){const g=d.color;(s==="any"||g[0]==s[0]&&g[1]==s[1]&&g[2]==s[2]&&g[3]==s[3])&&(d.color=o)}n.mergeNodeAttributes(e,{[c]:d})})},Ye=(n,s,o,i,a)=>{[...s,...o].forEach(e=>{n.setNodeAttribute(e,"zIndex",a)}),i.forEach(e=>{n.setEdgeAttribute(e,"zIndex",a)})},$e=n=>{const{isOpen:s,onClose:o,isSelect:i,filter:a}=n,{t:e}=ze(),c=Oe(),{selected:d}=N(t=>t.runtime),{preference:{autoParallel:g}}=N(t=>t.app),{activeSubscriptions:P}=N(t=>t.account),A=r.useCallback(()=>{c(U(h.current.export())),c(V()),c($())},[c,V,$,U]),h=r.useRef(window.graph),B={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(ee).map(([t,u])=>[t,e(u.metadata.displayName).toString()]))},w={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(b).map(([t,u])=>[t,e(u.metadata.displayName).toString()]))},M={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(x).map(([t,u])=>[t,e(u.metadata.displayName).toString()]))},C={id:"any",theme:[Le.Other,"other","#ffffff",Ne.black],value:e("header.settings.procedures.changeType.any")},[R,k]=r.useState(!1),[z,W]=r.useState(0),[Z,H]=r.useState(!1),[j,se]=r.useState("any"),[E,ne]=r.useState(T.ShmetroBasic),[_,D]=r.useState(!1),[v,ae]=r.useState("any"),[I,oe]=r.useState(te.SingleColor),[G,J]=r.useState(!1),[O,ie]=r.useState("any"),[L,ce]=r.useState(Pe.Diagonal),[K,X]=r.useState(!1),[m,Y]=r.useState(C),{theme:S,requestThemeChange:le}=Be(),[re,de]=r.useState([]),ue=[{id:"changeZIndex",title:e("header.settings.procedures.changeZIndex"),onClose:()=>k(!R),field:[{type:"select",label:e("panel.details.info.zIndex"),value:z,options:Object.fromEntries(Array.from({length:11},(t,u)=>[u-5,(u-5).toString()])),onChange:t=>W(Number(t))}]},{id:"changeStationType",title:e("header.settings.procedures.changeStationType.title"),onClose:()=>H(!Z),field:[{type:"select",label:e("header.settings.procedures.changeStationType.changeFrom"),options:M,value:j,disabledOptions:[E],onChange:t=>se(t)},{type:"select",label:e("header.settings.procedures.changeStationType.changeTo"),options:M,value:E,disabledOptions:["any",j],onChange:t=>ne(t)}]},{id:"changeLineStyleType",title:e("header.settings.procedures.changeLineStyleType.title"),onClose:()=>D(!_),field:[{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeFrom"),options:w,value:v,disabledOptions:[I],onChange:t=>ae(t)},{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeTo"),options:w,value:I,disabledOptions:["any",v],onChange:t=>oe(t)}]},{id:"changeLinePathType",title:e("header.settings.procedures.changeLinePathType.title"),onClose:()=>J(!G),field:[{type:"select",label:e("header.settings.procedures.changeLinePathType.changeFrom"),options:B,value:O,disabledOptions:[L],onChange:t=>ie(t)},{type:"select",label:e("header.settings.procedures.changeLinePathType.changeTo"),options:B,value:L,disabledOptions:["any","simple",O],onChange:t=>ce(t)}]},{id:"changeColor",title:e("header.settings.procedures.changeColor.title"),onClose:()=>X(!K),field:[{type:"custom",label:e("header.settings.procedures.changeColor.changeFrom"),component:l.jsx(we,{data:re,displayHandler:t=>l.jsx(Me,{name:t.value,fg:t.theme[3],bg:t.theme[2],title:t.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(t,u)=>u.id.toLowerCase().includes(t.toLowerCase())||Object.values(u.id).some(f=>f.toLowerCase().includes(t.toLowerCase())),value:m.value,onChange:t=>Y(t)})},{type:"custom",label:e("header.settings.procedures.changeColor.changeTo"),component:l.jsx(Re,{theme:S,onClick:le})}]}];r.useEffect(()=>{s&&(k(!1),H(!1),D(!1),J(!1),X(!1),W(0),de([C,...We(h.current,i?[...d].filter(t=>t.startsWith("stn")||t.startsWith("misc_node")):h.current.nodes(),i?[...d].filter(t=>t.startsWith("line")):h.current.edges()).map(t=>({id:t.toString(),theme:t,value:t[1]==="other"?t[2]:t[1]}))]),Y(C))},[s]);const he=()=>{const t=a!=null&&a.includes("station")?[...d].filter(p=>p.startsWith("stn")):i?[]:h.current.filterNodes(p=>p.startsWith("stn")),u=a!=null&&a.includes("misc-node")?[...d].filter(p=>p.startsWith("misc_node")):i?[]:h.current.filterNodes(p=>p.startsWith("misc_node")),f=i?[...d].filter(p=>p.startsWith("line")):h.current.edges();(!a||a.includes("station"))&&Z&&He(h.current,j,E,t),(!a||a.includes("line"))&&_&&Je(h.current,v,I,S,f),(!a||a.includes("line"))&&G&&De(h.current,O,L,f,g),K&&((!a||a.includes("line"))&&Ke(h.current,m.id==="any"?"any":m.theme,S,f),(!a||a.includes("misc-node")||a.includes("station"))&&Xe(h.current,m.id==="any"?"any":m.theme,S,t,u)),R&&Ye(h.current,t,u,f,z),A(),o()};return l.jsxs(ge,{isOpen:s,onClose:o,size:"md",scrollBehavior:"inside",children:[l.jsx(pe,{}),l.jsxs(fe,{children:[l.jsxs(ye,{children:[l.jsx(q,{as:"b",fontSize:"xl",children:e(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),l.jsx(me,{})]}),l.jsx(be,{children:l.jsx(Se,{allowMultiple:!0,children:ue.map(t=>l.jsxs(Te,{children:[l.jsxs(xe,{onClick:t.onClose,children:[l.jsx(Ae,{as:"span",flex:"1",textAlign:"left",children:l.jsx(q,{as:"b",fontSize:"md",children:t.title})}),l.jsx(Ce,{})]}),l.jsx(je,{pb:4,minH:420,children:l.jsx(ke,{fields:t.field,minW:270})})]},t.id))})}),l.jsxs(Ee,{children:[l.jsx(Q,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:e("cancel")}),l.jsx(ve,{label:e("header.settings.pro"),isOpen:!1,children:l.jsx(Q,{colorScheme:"red",mr:"1",onClick:he,isDisabled:!1,children:e("apply")})})]})]})]})};export{$e as C,Ge as a,Ze as b,_e as c};
