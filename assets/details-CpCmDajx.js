import{j as e,B as W,aj as R,ak as ce,av as _,t as N,aw as de,x as ue,D as pe,G as K,M as Q,H as Y,J as ee,L as te,O as ne,N as B}from"./chakra-CSR0Uih-.js";import{c as z,e as C,aB as he,T as ge,aC as me,aw as fe,q as w,v as E,o as O,at as I,L as se,l as xe,P as H,aD as F,t as T,S as ye,i as U,m as ae,aE as be,z as D,ax as q,aF as Se,aG as je,aH as we,aI as Ce,ay as Ne,n as J}from"./index-TYtKMSB_.js";import{u as L,b as c}from"./react-eFT_xHYJ.js";import{u as X,e as Ae}from"./clipboard-D7_gDw5t.js";import{s as G}from"./master-manager-BNVmxtPz.js";import{C as ve,c as Ee,a as Te,b as ke}from"./change-type-modal-CDbRXURK.js";import{l as ze,L as Le}from"./tools-BIWrsOK1.js";import{m as Pe}from"./misc-nodes-yC-28M5k.js";function Re(){const{t:n}=L(),i=z(),{selected:o}=C(a=>a.runtime),d=c.useRef(window.graph),u=a=>{if(d.current.hasNode(a)){const l=d.current.getNodeAttributes(a),f=l.type;return a.startsWith("stn")?l[f].names.join("/"):f}else if(d.current.hasEdge(a)){const[l,f]=d.current.extremities(a),p=d.current.getSourceAttributes(a),x=d.current.getTargetAttributes(a),S=p.type,g=x.type;return(l.startsWith("stn")?p[S].names[0]:S)+" - "+(f.startsWith("stn")?x[g].names[0]:g)}},[t,s]=c.useState([]);c.useEffect(()=>{s(["station","misc-node","line"])},[o]);const[r,m]=c.useState(!1);return e.jsxs(W,{children:[e.jsxs(R,{as:"h5",size:"sm",children:[n("panel.details.multipleSelection.selected")," ",o.size]}),e.jsxs(ce,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(R,{as:"h5",size:"xs",w:"100%",children:n("panel.details.multipleSelection.show")}),e.jsx(he,{selections:[{label:n("panel.details.multipleSelection.station"),value:"station"},{label:n("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:n("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:t,multiSelect:!0,onChange:a=>s(a)})]}),t.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(N,{width:"100%",size:"sm",onClick:()=>m(!0),children:[n("panel.details.multipleSelection.change"),e.jsx(de,{label:n("header.settings.pro"),children:e.jsx(ue,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(pe,{})]}),[...o].filter(a=>t.includes("station")||!a.startsWith("stn")).filter(a=>t.includes("misc-node")||!a.startsWith("misc")).filter(a=>t.includes("line")||!a.startsWith("line")).map(a=>{var l;return e.jsxs(_,{width:"100%",children:[e.jsx(N,{width:"100%",size:"sm",variant:"solid",onClick:()=>i(ge(new Set([a]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=u(a))==null?void 0:l.replaceAll("\n","⏎")}),e.jsx(N,{size:"sm",onClick:()=>i(fe(a)),children:e.jsx(me,{})})]},a)})]}),e.jsx(ve,{isOpen:r,onClose:()=>m(!1),isSelect:!0,filter:t})]})}function We(){var V,$;const{i18n:n,t:i}=L(),o=z(),d=c.useCallback(()=>{o(w(m.current.export())),o(E())},[o,E,w]),{preference:{autoParallel:u}}=C(j=>j.app),{selected:t,theme:s}=C(j=>j.runtime),[r]=t,m=c.useRef(window.graph),[a,l]=c.useState(!1),f=c.useRef(null),p=Object.fromEntries(Object.entries(O).map(([j,oe])=>[j,i(oe.metadata.displayName).toString()])),[x,S]=c.useState(m.current.getEdgeAttribute(r,"type")),[g,h]=c.useState(void 0),y=Object.fromEntries(($=(V=ze[n.language])==null?void 0:V.map(j=>[j,i(I[j].metadata.displayName).toString()]))!=null?$:[]),[b,A]=c.useState(m.current.getEdgeAttribute(r,"style")),[v,k]=c.useState(void 0);c.useEffect(()=>{S(m.current.getEdgeAttribute(r,"type")),A(m.current.getEdgeAttribute(r,"style"))},[r]);const P=Object.values(se).filter(j=>!1),re=Object.values(xe).filter(j=>!1),ie=()=>{g&&(Ee(m.current,r,g,u),S(m.current.getEdgeAttribute(r,"type")),d())},le=()=>{v&&(Te(m.current,r,v,s),A(m.current.getEdgeAttribute(r,"style")),d())},M=j=>{j&&(g?(ie(),h(void 0)):v&&(le(),k(void 0))),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{label:i("panel.details.info.linePathType"),minW:"276",children:e.jsx(F,{options:p,disabledOptions:P,defaultValue:x,value:x,onChange:({target:{value:j}})=>{h(j),l(!0)}})}),e.jsx(H,{label:i("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(F,{options:y,disabledOptions:re,defaultValue:b,value:b,onChange:({target:{value:j}})=>{k(j),l(!0)}})}),e.jsx(Le,{type:"line",expand:!0}),e.jsx(K,{isOpen:a,leastDestructiveRef:f,onClose:()=>M(!1),children:e.jsx(Q,{children:e.jsxs(Y,{children:[e.jsx(ee,{children:i("warning")}),e.jsx(te,{children:i("panel.details.changeLineTypeContent")}),e.jsxs(ne,{children:[e.jsx(N,{ref:f,onClick:()=>M(!1),children:i("cancel")}),e.jsx(N,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:i("panel.details.changeType")})]})]})})})]})}function Oe(){const{t:n}=L(),i=z(),o=c.useCallback(()=>{i(w(s.current.export())),i(T())},[i,T,w]),{selected:d,refresh:{nodes:u}}=C(y=>y.runtime),[t]=d,s=c.useRef(window.graph),[r,m]=c.useState(!1),a=c.useRef(null),[l,f]=c.useState(void 0),[p,x]=c.useState(ye.ShmetroBasic);c.useEffect(()=>{if(t!=null&&t.startsWith("stn")){const y=s.current.getNodeAttribute(t,"type");x(y)}},[u,d]);const S=Object.fromEntries(Object.entries(G).map(([y,b])=>[y,n(b.metadata.displayName).toString()])),g=()=>{l&&(ke(s.current,t,l),o())},h=y=>{y&&g(),f(void 0),m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(F,{options:S,disabledOptions:[p],value:p,onChange:({target:{value:y}})=>{f(y),m(!0)}})}),e.jsx(K,{isOpen:r,leastDestructiveRef:a,onClose:()=>h(!1),children:e.jsx(Q,{children:e.jsxs(Y,{children:[e.jsx(ee,{children:n("warning")}),e.jsx(te,{children:n("panel.details.changeStationTypeContent")}),e.jsxs(ne,{children:[e.jsx(N,{ref:a,onClick:()=>h(!1),children:n("cancel")}),e.jsx(N,{ml:"2",colorScheme:"red",onClick:()=>h(!0),children:n("panel.details.changeType")})]})]})})})]})}function Ie(){const{t:n}=L(),i=z(),o=c.useCallback(()=>{i(w(r.current.export())),i(T()),i(E())},[i,T,E,w]),{activeSubscriptions:d}=C(p=>p.account),{selected:u,count:{parallel:t}}=C(p=>p.runtime),[s]=u,r=c.useRef(window.graph),m=p=>{const x=Math.min(Math.max(p,-10),10);r.current.hasNode(s)&&r.current.setNodeAttribute(s,"zIndex",x),r.current.hasEdge(s)&&r.current.setEdgeAttribute(s,"zIndex",x),o()},a=(p,x)=>{let S=-1;if(p){const g=r.current.getEdgeAttributes(s),[h,y]=r.current.extremities(s);S=ae(r.current,g.type,h,y,x)}l(S)},l=p=>{r.current.setEdgeAttribute(s,"parallelIndex",p),i(w(r.current.export())),i(E())},f=[];if(u.size!==0)if(u.size===1){if(f.push({type:"input",label:n("panel.details.info.id"),value:s,minW:276}),f.push({type:"select",label:n("panel.details.info.zIndex"),value:s?r.current.hasNode(s)?r.current.getNodeAttribute(s,"zIndex"):r.current.hasEdge(s)?r.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(p,x)=>[x-10,(x-10).toString()])),onChange:p=>m(Number(p))}),r.current.hasEdge(s)){const p=r.current.getEdgeAttributes(s),{parallelIndex:x,type:S}=p,g=be,h=t>g&&x<0||S===se.Simple,y=t>g&&x>=0;f.push({type:"switch",label:n("panel.details.info.parallel"),isDisabled:h,isChecked:x>=0,onChange:b=>a(b,p[p.type].startFrom),oneLine:!0,minW:276}),x>=0&&f.push({type:"input",label:n("panel.details.info.parallelIndex"),variant:"number",isDisabled:y,value:p.parallelIndex.toString(),onChange:b=>l(Number(b)),minW:276})}}else u.size>1&&f.push({type:"input",label:n("panel.details.info.type"),value:n("panel.details.multipleSelection.title"),minW:276});return e.jsxs(W,{p:1,children:[e.jsx(R,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(U,{fields:f,minW:130}),u.size===1&&s.startsWith("stn")&&r.current.hasNode(s)&&r.current.getNodeAttribute(s,"type")in G&&e.jsx(Oe,{}),u.size===1&&s.startsWith("line")&&r.current.hasEdge(s)&&r.current.getEdgeAttribute(s,"type")in O&&r.current.getEdgeAttribute(s,"style")in I&&e.jsx(We,{}),u.size>1&&e.jsx(Re,{})]})}function De(){const{t:n}=L(),i=z(),{selected:o}=C(h=>h.runtime),[d]=o,u=c.useRef(window.graph),[t,s]=c.useState("undefined"),[r,m]=c.useState("undefined"),[a,l]=c.useState("undefined"),[f,p]=c.useState("undefined");c.useEffect(()=>{var h,y,b,A;if(d!=null&&d.startsWith("line")){const[v,k]=u.current.extremities(d);if(s(v),m(k),v.startsWith("stn")){const P=u.current.getNodeAttribute(v,"type");l((y=(h=u.current.getNodeAttribute(v,P))==null?void 0:h.names.at(0))!=null?y:"undefined")}if(k.startsWith("stn")){const P=u.current.getNodeAttribute(k,"type");p((A=(b=u.current.getNodeAttribute(k,P))==null?void 0:b.names.at(0))!=null?A:"undefined")}}},[o]);const x=X(()=>{i(D()),i(q(t))}),S=X(()=>{i(D()),i(q(r))}),g=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(N,{ml:"auto",size:"sm",variant:"link",onClick:x,children:t}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:a,minW:"full"},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(N,{ml:"auto",size:"sm",variant:"link",onClick:S,children:r}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:f,minW:"full"}];return e.jsxs(W,{p:1,children:[e.jsx(R,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(U,{fields:g,minW:130})]})}function Me(){const{t:n}=L(),i=z(),o=c.useCallback(()=>{i(w(s.current.export())),i(T()),i(E())},[i,T,E,w]),{selected:d,refresh:{nodes:u}}=C(l=>l.runtime),[t]=d,s=c.useRef(window.graph),[r,m]=c.useState({x:0,y:0});c.useEffect(()=>{if(t!=null&&t.startsWith("stn")||t!=null&&t.startsWith("misc_node_")){const l=s.current.getNodeAttribute(t,"x"),f=s.current.getNodeAttribute(t,"y");m({x:l,y:f})}},[u,d]);const a=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:r.x.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{s.current.mergeNodeAttributes(t,{x:Number(l)}),o()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:r.y.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{s.current.mergeNodeAttributes(t,{y:Number(l)}),o()}}];return e.jsxs(W,{p:1,children:[e.jsx(R,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(U,{fields:a,minW:130})]})}const Z={...G,...Pe},_e=()=>{var m;const n=z(),{selected:i}=C(a=>a.runtime),{t:o}=L(),[d]=i,u=window.graph.getNodeAttribute(d,"type"),t=u in Z&&Z[u].attrsComponent,s=(m=window.graph.getNodeAttribute(d,u))!=null?m:{},r=(a,l)=>{const f=window.graph.getNodeAttribute(a,"type");window.graph.mergeNodeAttributes(a,{[f]:l}),n(w(window.graph.export())),n(T())};return t?e.jsx(t,{id:d,attrs:s,handleAttrsUpdate:r}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},Be=()=>{var h,y;const n=z(),{preference:{autoParallel:i}}=C(b=>b.app),{selected:o}=C(b=>b.runtime),{t:d}=L(),[u]=o,{type:t,style:s,parallelIndex:r,reconcileId:m}=window.graph.getEdgeAttributes(u),a=(h=window.graph.getEdgeAttribute(u,t))!=null?h:{},l=t in O&&O[t].attrsComponent,f=(y=window.graph.getEdgeAttribute(u,s))!=null?y:{},p=s in I&&I[s].attrsComponent,x=(b,A)=>{let v=-1;if(i){const[k,P]=window.graph.extremities(b);v=ae(window.graph,t,k,P,A)}window.graph.setEdgeAttribute(b,"parallelIndex",v)},S=(b,A)=>{window.graph.mergeEdgeAttributes(b,{[t]:A}),n(w(window.graph.export())),n(E())},g=(b,A)=>{window.graph.mergeEdgeAttributes(b,{[s]:A}),n(w(window.graph.export())),n(E())};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:u,attrs:a,recalculateParallelIndex:x,handleAttrsUpdate:S,parallelIndex:r}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.linePath")})}),p?e.jsx(p,{id:u,attrs:f,handleAttrsUpdate:g,reconcileId:m}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.lineStyle")})})]})},Xe=()=>{const{t:n}=L(),i=z(),o=c.useRef(window.graph),d=c.useCallback(()=>{i(w(o.current.export())),i(T()),i(E())},[i,T,E,w]),{activeSubscriptions:u}=C(g=>g.account),{selected:t,mode:s,active:r,count:{masters:m}}=C(g=>g.runtime),[a]=t,l=!1,f=()=>i(D()),p=g=>{const h=structuredClone(o.current.getNodeAttributes(g));h.x+=50,h.y+=50;const y=g.startsWith("stn")?"stn_".concat(J(10)):"misc_node_".concat(J(10));o.current.addNode(y,h),i(w(o.current.export())),i(T())},x=g=>{const h=Ae(o.current,g);navigator.clipboard.writeText(h)},S=g=>{i(D()),g.forEach(h=>{o.current.hasNode(h)?o.current.dropNode(h):o.current.hasEdge(h)&&o.current.dropEdge(h)}),d()};return e.jsxs(Se,{isOpen:t.size>0&&!s.startsWith("line")&&!r,width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(je,{onClose:f,children:n("panel.details.header")}),e.jsxs(we,{children:[e.jsx(Ie,{}),t.size===1&&o.current.hasNode(a)&&e.jsx(Me,{}),t.size===1&&o.current.hasEdge(a)&&e.jsx(De,{}),t.size===1&&e.jsxs(W,{p:1,children:[e.jsx(R,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(a)&&e.jsx(_e,{}),window.graph.hasEdge(a)&&e.jsx(Be,{})]})]}),e.jsx(Ce,{children:e.jsxs(_,{children:[t.size===1&&o.current.hasNode(a)&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>p(a),isDisabled:o.current.getNodeAttributes(a).type===Ne.Master&&l,children:n("panel.details.footer.duplicate")}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>x(t),children:n("panel.details.footer.copy")}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>S(t),children:n("panel.details.footer.remove")})]})})]})};export{Xe as default};
